import java.awt.*;
import java.awt.event.*;

public class Desenhar extends Frame {
    
    /**
     * @param args the command line arguments
     */
    public static void main(String[] args){
        int num = 3;
        quadro[] q = new quadro[16];
        q[0] = new quadro (61,71,2);
        q[1] = new quadro (161,71,2);
        q[2] = new quadro (361,71,4);
        new janela(q,num).show();
    }
    
}

public class janela extends Frame  implements KeyListener{
    quadro[] q = new quadro[16];
    tile_background[] t = new tile_background[16];
    Graphics g2;
    public int num;
    public int change;
    public janela(quadro q[],int num) {
        this.num = num;
        this.change = this.num;
        setSize(521,521);
        setTitle("mecher setinhas");
        for (int i=0; i<this.num;i++)
        this.q[i] = q[i];
        addKeyListener(this);
        addWindowListener(new WindowAdapter(){
            public void windowClosing(WindowEvent we){
                System.exit(0);
            }
        });
        //generate tile background
        for(int i=0;i<16;i++){
            t[i] = new tile_background();
            this.t[i].x = i%4 * 100 + 61;
            this.t[i].y =  (int)i/4 * 100 + 71;
            }
    }
    
    public void paint(Graphics g){
        
        g.drawRect(40, 50, 421, 421);
        for (int i=0;i<16;i++){
            g.setColor(Color.blue);
            g.fillRect(this.t[i].x, this.t[i].y, 80, 80);
        }
        for(int i=0;i<this.q.length;i++){
            g.setColor(Color.CYAN);
            try{
            g.fillRect(this.q[i].x,this.q[i].y,80,80);
            g.setColor(Color.BLACK);
            g.drawString("" + this.q[i].valor, this.q[i].x+40, this.q[i].y +40);
            }
            catch(Exception e){}
            this.g2 = g;
        }
        
        
    }
    
    public void keyPressed(KeyEvent ke){
        
        int keyCode = ke.getKeyCode();
        
        switch(keyCode){
        
            case KeyEvent.VK_UP:
                for(int i = 0;i<this.num;i++)
                    this.num = this.q[i].slide(0, q,this.num);
                
                break;
            case KeyEvent.VK_LEFT:
                for(int i = 0; i<this.num;i++){
                        this.change = this.q[i].slide(1, q,this.num);
                        if(this.change < this.num)i-=1;
                        this.num = this.change;
                }
                break;
            case KeyEvent.VK_RIGHT:
                for(int i=0;i<this.num;i++)
                    this.num = this.q[i].slide(2, q,this.num);
                
                
                break;
            case KeyEvent.VK_DOWN:
                for(int i=0;i<this.num;i++)
                    this.num = this.q[i].slide(3, q,this.num);
                
                
                
                break;
             
        }
        for(int i = 0;i<this.num;i++)
            this.q[i].merging = false;
        repaint();
        
    }
      public void keyTyped(KeyEvent ke){
        
    }
    public void keyReleased(KeyEvent ke){
        
    }
    
    
}

public abstract class Tile {
    int x,y,valor;
    String Color;
    abstract boolean collision(quadro[] q, int k, int num);
    abstract int slide(int x,quadro[]q,int num);
    
    
}

public class quadro extends Tile {
    int x,y,valor;
    String Color;
    boolean merging;
    int num;
    public quadro(int x, int y,int valor) {
        this.x = x;
        this.y = y;
        this.valor=valor;
        this.merging = false;
    }
    
    public boolean collision(quadro[] q,int k, int num){
        for(int i=0;i<this.num;i++){
            switch (k){
                case 0:
                    if(this.y == q[i].y +100 && this.x == q[i].x){
                        if(q[i].merging == false && this.valor == q[i].valor && !q[i].merging){
                            merge(q,i,this.num);
                            i=0;
                            return false;
                            
                        }
                        else
                        return true;}
                    break;
                case 1:
                    if(this.x == q[i].x +100 && this.y == q[i].y){
                        if(this.valor == q[i].valor && !this.merging && !q[i].merging){
                            merge(q,i,this.num);
                            i=0;
                            return false;
                        }
                        else
                        return true;}
                    else
                        return false;
                    
                case 2:
                    if(this.x+100 == q[i].x && this.y == q[i].y){
                        if(this.valor == q[i].valor && !this.merging && !q[i].merging){
                            merge(q,i,this.num);
                            i=0;
                            return false;
                        }
                        else
                        return true;}
                    break;
                case 3:
                    if(this.y+100 == q[i].y && this.x == q[i].x){
                        if(this.valor == q[i].valor && !this.merging && !q[i].merging){
                            merge(q,i,this.num);
                            i=0;
                            return false;
                        }
                        else
                        return true;}
                    break;
            
            }
        }
        return false;
                     
    }
    public int slide(int x,quadro[] q,int num){
        this.num = num;
        switch(x){
            case 0:
                while(this.y>71 && !this.collision(q,0,this.num)){this.y = this.y - 1;}
                return this.num;
            case 1:
                while(this.x>61 && !this.collision(q,1,this.num)){this.x = this.x - 1;}
                
                return this.num;
            case 2:
                while(this.x<361&& !this.collision(q,2,this.num)){this.x = this.x + 1;}
                
                return this.num;
            case 3:
                while(this.y<371 && !this.collision(q,3,this.num)){this.y = this.y + 1;}
                
                return this.num;
                
        }
        return num;
    }
    public void merge(quadro[] q,int i,int num){
        this.valor = 2*this.valor;
        this.merging = true;
        for(;i<num;i++)
            q[i] = q[i+1];
        this.num --;
    }
}

public class tile_background {
    public int x,y;

    public tile_background(int x, int y) {
        this.x = x;
        this.y = y;
    }

    public tile_background() {
    }
    
    
    
    public boolean isopen(quadro[] q){
        try{
        for (int i=0;i<q.length;i++){
            if (q[i].x == this.x && q[i].y==this.y)
                return false;
        }
        }
        catch(Exception e){}
        return true;
    }
    
}
